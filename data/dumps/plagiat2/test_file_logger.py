Module(body=[Import(names=[alias(name='datetime')]), ImportFrom(module='unittest', names=[alias(name='mock')], level=0), ImportFrom(module='etna.metrics', names=[alias(name='MSE')], level=0), Import(names=[alias(name='os')]), Import(names=[alias(name='tempfile')]), Import(names=[alias(name='json')]), ImportFrom(module='etna.loggers', names=[alias(name='tslogger')], level=0), ImportFrom(module='etna.metrics', names=[alias(name='SMAPE')], level=0), Import(names=[alias(name='pytest')]), ImportFrom(module='etna.datasets', names=[alias(name='TSDataset')], level=0), ImportFrom(module='etna.ensembles', names=[alias(name='StackingEnsemble')], level=0), ImportFrom(module='etna.loggers', names=[alias(name='LocalFileLogger')], level=0), ImportFrom(module='etna.loggers', names=[alias(name='S3FileLogger')], level=0), Import(names=[alias(name='pandas', asname='pd')]), ImportFrom(module='etna.metrics', names=[alias(name='MAE')], level=0), Import(names=[alias(name='numpy', asname='np')]), Import(names=[alias(name='pathlib')]), ImportFrom(module='etna.models', names=[alias(name='NaiveModel')], level=0), ImportFrom(module='etna.pipeline', names=[alias(name='Pipeline')], level=0), Assign(targets=[Name(id='DATETIME_FORMAT', ctx=Store())], value=Constant(value='%Y-%m-%dT%H-%M-%S')), FunctionDef(name='test_local_file_logger_init_new_dir', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Test that LIocalFileLogƜger createξs subΗfoldϘer duƆring init.')), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=0)])), Assign(targets=[Name(id='__', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load()))])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]))])], decorator_list=[]), FunctionDef(name='test_s3_file_logger_fail_init_aws_access_key_id', args=arguments(posonlyargs=[], args=[arg(arg='monkeypatch')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='setenv', ctx=Load()), args=[Constant(value='endpoint_url'), Constant(value='https://s3.example.com')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='delenv', ctx=Load()), args=[Constant(value='aws_access_key_id')], keywords=[keyword(arg='raising', value=Constant(value=False))])), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='setenv', ctx=Load()), args=[Constant(value='aws_secret_access_key'), Constant(value='example')], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='oserror', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='Environment variable `aws_access_key_id` should be specified'))]))], body=[Assign(targets=[Name(id='__', ctx=Store())], value=Call(func=Name(id='S3FileLogger', ctx=Load()), args=[], keywords=[keyword(arg='bucket', value=Constant(value='example')), keyword(arg='experiments_folder', value=Constant(value='experiments_folder'))]))])], decorator_list=[]), FunctionDef(name='test_local_file_logger_save_dict', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load()))])), Assign(targets=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[]), slice=Constant(value=0), ctx=Load())), Assign(targets=[Name(id='experiment_folder', ctx=Store())], value=Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='joinpath', ctx=Load()), args=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='start_experiment', ctx=Load()), args=[], keywords=[keyword(arg='job_type', value=Constant(value='example')), keyword(arg='group', value=Constant(value='example'))])), Assign(targets=[Name(id='EXAMPLE_DICT', ctx=Store())], value=Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='first'), Constant(value='second'), Constant(value='third')], ctx=Load())])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_dict', ctx=Load()), args=[Name(id='EXAMPLE_DICT', ctx=Load()), Constant(value='example')], keywords=[])), Assign(targets=[Name(id='experiment_subfolder', ctx=Store())], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='experiment_folder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='example')], keywords=[]), attr='joinpath', ctx=Load()), args=[Constant(value='example')], keywords=[])), Assert(test=Compare(left=Constant(value='example.json'), ops=[In()], comparators=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='experiment_subfolder', ctx=Load())], keywords=[])])), With(items=[withitem(context_expr=Call(func=Name(id='open', ctx=Load()), args=[Call(func=Attribute(value=Name(id='experiment_subfolder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='example.json')], keywords=[])], keywords=[]), optional_vars=Name(id='inf', ctx=Store()))], body=[Assign(targets=[Name(id='READ_EXAMPLE_DICT', ctx=Store())], value=Call(func=Attribute(value=Name(id='json', ctx=Load()), attr='load', ctx=Load()), args=[Name(id='inf', ctx=Load())], keywords=[]))]), Assert(test=Compare(left=Name(id='READ_EXAMPLE_DICT', ctx=Load()), ops=[Eq()], comparators=[Name(id='EXAMPLE_DICT', ctx=Load())]))])], decorator_list=[]), FunctionDef(name='test_local_file_', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load()))])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='1'), Constant(value='2'), Constant(value='3')], ctx=Load())])], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='ValueError', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='You should start experiment before'))]))], body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_table', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load()), Constant(value='example')], keywords=[]))])])], decorator_list=[]), FunctionDef(name='test_local_file_logger_save_table', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='ÓTe\x99s˸tƂ\x9f̒ΰ Ȩ\x93tʛŅhaʿt ɝ\x96ΝċLoŰca̼ɺlǿƻFʗ̆γiĖ̪leLoggYer ȥsaϵvķ̔esͨʒ ta͠bl̔͗\x81őe afΞĵteƃr Ȳ˦Yˈőˡȭĕstaɲr>˯tiūng\x9b͗ thʸ̷Ŵʜe ̹eȆx\x80peɡ˸rimÌent˓.')), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load())), keyword(arg='gzip', value=Constant(value=False))])), Assign(targets=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[]), slice=Constant(value=0), ctx=Load())), Assign(targets=[Name(id='experiment_folder', ctx=Store())], value=Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='joinpath', ctx=Load()), args=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='start_experiment', ctx=Load()), args=[], keywords=[keyword(arg='job_type', value=Constant(value='example')), keyword(arg='group', value=Constant(value='example'))])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='first'), Constant(value='second'), Constant(value='third')], ctx=Load())])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_table', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load()), Constant(value='example')], keywords=[])), Assign(targets=[Name(id='experiment_subfolder', ctx=Store())], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='experiment_folder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='example')], keywords=[]), attr='joinpath', ctx=Load()), args=[Constant(value='example')], keywords=[])), Assert(test=Compare(left=Constant(value='example.csv'), ops=[In()], comparators=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='experiment_subfolder', ctx=Load())], keywords=[])])), Assign(targets=[Name(id='read_example_df', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='read_csv', ctx=Load()), args=[Call(func=Attribute(value=Name(id='experiment_subfolder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='example.csv')], keywords=[])], keywords=[])), Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='all', ctx=Load()), args=[Compare(left=Name(id='read_example_df', ctx=Load()), ops=[Eq()], comparators=[Name(id='example_dffzohH', ctx=Load())])], keywords=[]))])], decorator_list=[]), FunctionDef(name='test_s3_file_logger_fail_init_aws_secret_access_key', args=arguments(posonlyargs=[], args=[arg(arg='monkeypatch')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="Te\xad̐st Ɓthat S3FÁçiɾlǹeLogger can't be ͫʚcreated without settοɨing« 'aw˞§s_smʺǌecreÖtŉ_Eacc̄eǮss_kʔȴeyɜü' envi϶ƶroʶnmenϊt variable.")), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='setenv', ctx=Load()), args=[Constant(value='endpoint_url'), Constant(value='https://s3.example.com')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='setenv', ctx=Load()), args=[Constant(value='aws_access_key_id'), Constant(value='example')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='delenv', ctx=Load()), args=[Constant(value='aws_secret_access_key')], keywords=[keyword(arg='raising', value=Constant(value=False))])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='oserror', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='Environment variable `aws_secret_access_key` should be specified'))]))], body=[Assign(targets=[Name(id='__', ctx=Store())], value=Call(func=Name(id='S3FileLogger', ctx=Load()), args=[], keywords=[keyword(arg='bucket', value=Constant(value='example')), keyword(arg='experiments_folder', value=Constant(value='experiments_folder'))]))])], decorator_list=[]), FunctionDef(name='test_local_file_logger_fail_save_dict', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load()))])), Assign(targets=[Name(id='EXAMPLE_DICT', ctx=Store())], value=Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='first'), Constant(value='second'), Constant(value='third')], ctx=Load())])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='ValueError', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='You should start experiment before'))]))], body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_dict', ctx=Load()), args=[Name(id='EXAMPLE_DICT', ctx=Load()), Constant(value='example')], keywords=[]))])])], decorator_list=[]), FunctionDef(name='TEST_BASE_FILE_LOGGER_LOG_BACKTEST_RUN', args=arguments(posonlyargs=[], args=[arg(arg='example_tsds', annotation=Name(id='TSDataset', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load())), keyword(arg='gzip', value=Constant(value=False))])), Assign(targets=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[]), slice=Constant(value=0), ctx=Load())), Assign(targets=[Name(id='experiment_folder', ctx=Store())], value=Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='joinpath', ctx=Load()), args=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Load())], keywords=[])), Assign(targets=[Name(id='i_dx', ctx=Store())], value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='add', ctx=Load()), args=[Name(id='logger', ctx=Load())], keywords=[])), Assign(targets=[Name(id='metricsF', ctx=Store())], value=List(elts=[Call(func=Name(id='MAE', ctx=Load()), args=[], keywords=[]), Call(func=Name(id='MSE', ctx=Load()), args=[], keywords=[]), Call(func=Name(id='SMAPE', ctx=Load()), args=[], keywords=[])], ctx=Load())), Assign(targets=[Name(id='pipeline', ctx=Store())], value=Call(func=Name(id='Pipeline', ctx=Load()), args=[], keywords=[keyword(arg='model', value=Call(func=Name(id='NaiveModel', ctx=Load()), args=[], keywords=[])), keyword(arg='horizon', value=Constant(value=10))])), Assign(targets=[Name(id='n_foldsqgAJh', ctx=Store())], value=Constant(value=5)), Expr(value=Call(func=Attribute(value=Name(id='pipeline', ctx=Load()), attr='backtest', ctx=Load()), args=[], keywords=[keyword(arg='ts', value=Name(id='example_tsds', ctx=Load())), keyword(arg='metrics', value=Name(id='metricsF', ctx=Load())), keyword(arg='n_jobs', value=Constant(value=1)), keyword(arg='n_folds', value=Name(id='n_foldsqgAJh', ctx=Load()))])), For(target=Name(id='f', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Name(id='n_foldsqgAJh', ctx=Load())], keywords=[]), body=[Assign(targets=[Name(id='fold_folder', ctx=Store())], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='experiment_folder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='crossval')], keywords=[]), attr='joinpath', ctx=Load()), args=[Call(func=Name(id='str', ctx=Load()), args=[Name(id='f', ctx=Load())], keywords=[])], keywords=[])), Assert(test=Compare(left=Constant(value='metrics.csv'), ops=[In()], comparators=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='fold_folder', ctx=Load())], keywords=[])])), Assert(test=Compare(left=Constant(value='forecast.csv'), ops=[In()], comparators=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='fold_folder', ctx=Load())], keywords=[])])), Assert(test=Compare(left=Constant(value='test.csv'), ops=[In()], comparators=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='fold_folder', ctx=Load())], keywords=[])])), With(items=[withitem(context_expr=Call(func=Name(id='open', ctx=Load()), args=[Call(func=Attribute(value=Name(id='fold_folder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='metrics_summary.json')], keywords=[]), Constant(value='r')], keywords=[]), optional_vars=Name(id='inf', ctx=Store()))], body=[Assign(targets=[Name(id='metrics_summary', ctx=Store())], value=Call(func=Attribute(value=Name(id='json', ctx=Load()), attr='load', ctx=Load()), args=[Name(id='inf', ctx=Load())], keywords=[]))]), Assign(targets=[Name(id='statistic_keys', ctx=Store())], value=List(elts=[Constant(value='median'), Constant(value='mean'), Constant(value='std'), Constant(value='percentile_5'), Constant(value='percentile_25'), Constant(value='percentile_75'), Constant(value='percentile_95')], ctx=Load())), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Attribute(value=Name(id='metrics_summary', ctx=Load()), attr='keys', ctx=Load()), args=[], keywords=[])], keywords=[]), ops=[Eq()], comparators=[BinOp(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='metricsF', ctx=Load())], keywords=[]), op=Mult(), right=Call(func=Name(id='len', ctx=Load()), args=[Name(id='statistic_keys', ctx=Load())], keywords=[]))]))], orelse=[])]), Expr(value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='remove', ctx=Load()), args=[Name(id='i_dx', ctx=Load())], keywords=[]))], decorator_list=[]), FunctionDef(name='test_local_file_logger_save_config', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='example_c_onfig', ctx=Store())], value=Dict(keys=[Constant(value='key')], values=[Constant(value='value')])), Assign(targets=[Name(id='__', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load())), keyword(arg='config', value=Name(id='example_c_onfig', ctx=Load()))])), Assign(targets=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[]), slice=Constant(value=0), ctx=Load())), Assign(targets=[Name(id='experiment_folder', ctx=Store())], value=Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='joinpath', ctx=Load()), args=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Load())], keywords=[])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='experiment_folder', ctx=Load())], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)])), With(items=[withitem(context_expr=Call(func=Name(id='open', ctx=Load()), args=[Call(func=Attribute(value=Name(id='experiment_folder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='config.json')], keywords=[])], keywords=[]), optional_vars=Name(id='inf', ctx=Store()))], body=[Assign(targets=[Name(id='read_config', ctx=Store())], value=Call(func=Attribute(value=Name(id='json', ctx=Load()), attr='load', ctx=Load()), args=[Name(id='inf', ctx=Load())], keywords=[]))]), Assert(test=Compare(left=Name(id='read_config', ctx=Load()), ops=[Eq()], comparators=[Name(id='example_c_onfig', ctx=Load())]))])], decorator_list=[]), FunctionDef(name='test_local_file_logger_with_stackin_g_ensemble', args=arguments(posonlyargs=[], args=[arg(arg='example_dffzohH')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='TeĕãǦˠMŁ̯stɯ Ǽthϐ\x84aǒt ƊLocς́alFi̚ˁleϓŴĆLoïgRļgeɛŗrϲ correctlϚyȰ ĿÝworȐͮks ʫin w]ithͦ \x82sşt̘ackÍiƟng.ò̋ͽɥ')), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load())), keyword(arg='gzip', value=Constant(value=False))])), Assign(targets=[Name(id='i_dx', ctx=Store())], value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='add', ctx=Load()), args=[Name(id='logger', ctx=Load())], keywords=[])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Attribute(value=Name(id='TSDataset', ctx=Load()), attr='to_dataset', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load())], keywords=[])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Name(id='TSDataset', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load())], keywords=[keyword(arg='freq', value=Constant(value='1H'))])), Assign(targets=[Name(id='ensemble_pipeline', ctx=Store())], value=Call(func=Name(id='StackingEnsemble', ctx=Load()), args=[], keywords=[keyword(arg='pipelines', value=List(elts=[Call(func=Name(id='Pipeline', ctx=Load()), args=[], keywords=[keyword(arg='model', value=Call(func=Name(id='NaiveModel', ctx=Load()), args=[], keywords=[keyword(arg='lag', value=Constant(value=10))])), keyword(arg='transforms', value=List(elts=[], ctx=Load())), keyword(arg='horizon', value=Constant(value=5))]), Call(func=Name(id='Pipeline', ctx=Load()), args=[], keywords=[keyword(arg='model', value=Call(func=Name(id='NaiveModel', ctx=Load()), args=[], keywords=[keyword(arg='lag', value=Constant(value=10))])), keyword(arg='transforms', value=List(elts=[], ctx=Load())), keyword(arg='horizon', value=Constant(value=5))])], ctx=Load()))])), Assign(targets=[Name(id='n_foldsqgAJh', ctx=Store())], value=Constant(value=5)), Assign(targets=[Name(id='__', ctx=Store())], value=Call(func=Attribute(value=Name(id='ensemble_pipeline', ctx=Load()), attr='backtest', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load())], keywords=[keyword(arg='metrics', value=List(elts=[Call(func=Name(id='MAE', ctx=Load()), args=[], keywords=[])], ctx=Load())), keyword(arg='n_jobs', value=Constant(value=4)), keyword(arg='n_folds', value=Name(id='n_foldsqgAJh', ctx=Load()))])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), msg=Constant(value="we've run one experiment")), Assign(targets=[Name(id='CURRENT_EXPERIMENT_DIR', ctx=Store())], value=Subscript(value=Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[]), slice=Constant(value=0), ctx=Load())), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=Name(id='CURRENT_EXPERIMENT_DIR', ctx=Load()), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=2)]), msg=Constant(value='crossval and crossval_results folders')), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=BinOp(left=Name(id='CURRENT_EXPERIMENT_DIR', ctx=Load()), op=Div(), right=Constant(value='crossval')), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Name(id='n_foldsqgAJh', ctx=Load())]), msg=Constant(value='crossval should have `n_folds` runs')), Expr(value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='remove', ctx=Load()), args=[Name(id='i_dx', ctx=Load())], keywords=[]))])], decorator_list=[]), FunctionDef(name='test_local_file_logger_with_empirical_prediction_interval', args=arguments(posonlyargs=[], args=[arg(arg='example_dffzohH')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="ǆTe¤sƸt'˖ʴ t·*ǎh̺ľơő\\Ǧ©Ȟaƴtª L:ǹȴÀocaƄlF̸ilϊôeL%og͜gerj ͚corrɗƳeȯœctlΧyGk ʯσ\x9f¦wϩ\x80orõks iŰ\x95n ϲ5witȠHhŐ ȻeAmʤYȐhƒpiriɣǖģcalˢϚ̫ ʝprediͶǍcui͢tionɓ ϞȤinteλrvals viȘ͞ϏűaƩϵ bͮ͆acɘktįʛeǩģst.")), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load())), keyword(arg='gzip', value=Constant(value=False))])), Assign(targets=[Name(id='i_dx', ctx=Store())], value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='add', ctx=Load()), args=[Name(id='logger', ctx=Load())], keywords=[])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Attribute(value=Name(id='TSDataset', ctx=Load()), attr='to_dataset', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load())], keywords=[])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Name(id='TSDataset', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load())], keywords=[keyword(arg='freq', value=Constant(value='1H'))])), Assign(targets=[Name(id='pipe', ctx=Store())], value=Call(func=Name(id='Pipeline', ctx=Load()), args=[], keywords=[keyword(arg='model', value=Call(func=Name(id='NaiveModel', ctx=Load()), args=[], keywords=[])), keyword(arg='transforms', value=List(elts=[], ctx=Load())), keyword(arg='horizon', value=Constant(value=2))])), Assign(targets=[Name(id='n_foldsqgAJh', ctx=Store())], value=Constant(value=5)), Assign(targets=[Name(id='__', ctx=Store())], value=Call(func=Attribute(value=Name(id='pipe', ctx=Load()), attr='backtest', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load())], keywords=[keyword(arg='metrics', value=List(elts=[Call(func=Name(id='MAE', ctx=Load()), args=[], keywords=[])], ctx=Load())), keyword(arg='n_jobs', value=Constant(value=4)), keyword(arg='n_folds', value=Name(id='n_foldsqgAJh', ctx=Load())), keyword(arg='forecast_params', value=Dict(keys=[Constant(value='prediction_interval')], values=[Constant(value=True)]))])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)]), msg=Constant(value="we've run one experiment")), Assign(targets=[Name(id='CURRENT_EXPERIMENT_DIR', ctx=Store())], value=Subscript(value=Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[]), slice=Constant(value=0), ctx=Load())), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=Name(id='CURRENT_EXPERIMENT_DIR', ctx=Load()), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=2)]), msg=Constant(value='crossval and crossval_results folders')), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Name(id='list', ctx=Load()), args=[Call(func=Attribute(value=BinOp(left=Name(id='CURRENT_EXPERIMENT_DIR', ctx=Load()), op=Div(), right=Constant(value='crossval')), attr='iterdir', ctx=Load()), args=[], keywords=[])], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Name(id='n_foldsqgAJh', ctx=Load())]), msg=Constant(value='crossval should have `n_folds` runs')), Expr(value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='remove', ctx=Load()), args=[Name(id='i_dx', ctx=Load())], keywords=[]))])], decorator_list=[]), FunctionDef(name='test_s3_file_logger_fail_init_endpoint_url', args=arguments(posonlyargs=[], args=[arg(arg='monkeypatch')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='delenv', ctx=Load()), args=[Constant(value='endpoint_url')], keywords=[keyword(arg='raising', value=Constant(value=False))])), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='setenv', ctx=Load()), args=[Constant(value='aws_access_key_id'), Constant(value='example')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load()), attr='setenv', ctx=Load()), args=[Constant(value='aws_secret_access_key'), Constant(value='example')], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='oserror', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='Environment variable `endpoint_url` should be specified'))]))], body=[Assign(targets=[Name(id='__', ctx=Store())], value=Call(func=Name(id='S3FileLogger', ctx=Load()), args=[], keywords=[keyword(arg='bucket', value=Constant(value='example')), keyword(arg='experiments_folder', value=Constant(value='experiments_folder'))]))])], decorator_list=[]), FunctionDef(name='test_s3_file_lo', args=arguments(posonlyargs=[], args=[arg(arg='check_bucket_fn'), arg(arg='get_s3_client_fn')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='S3FileLogger', ctx=Load()), args=[], keywords=[keyword(arg='bucket', value=Constant(value='example')), keyword(arg='experiments_folder', value=Constant(value='experiments_folder'))])), Assign(targets=[Name(id='EXAMPLE_DICT', ctx=Store())], value=Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='first'), Constant(value='second'), Constant(value='third')], ctx=Load())])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='ValueError', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='You should start experiment before'))]))], body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_dict', ctx=Load()), args=[Name(id='EXAMPLE_DICT', ctx=Load()), Constant(value='example')], keywords=[]))])], decorator_list=[Call(func=Attribute(value=Name(id='mock', ctx=Load()), attr='patch', ctx=Load()), args=[Constant(value='etna.loggers.S3FileLogger._check_bucket')], keywords=[keyword(arg='return_value', value=Constant(value=None))]), Call(func=Attribute(value=Name(id='mock', ctx=Load()), attr='patch', ctx=Load()), args=[Constant(value='etna.loggers.S3FileLogger._get_s3_client')], keywords=[keyword(arg='return_value', value=Constant(value=None))])]), FunctionDef(name='test_local_file_logger_start_experimen', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Te˳st th˼̚ɬȑat ˙LoʕcǪalFɯ\x8eile8LoggƯɌerδ crea˒te̞sí Şnew subfoldʕĘɟer according ʗto̸ 8the \x90paraȥmeterǠsć.')), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='start_datetimeUb', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='datetime', ctx=Load()), attr='datetime', ctx=Load()), attr='strptime', ctx=Load()), args=[Call(func=Attribute(value=Call(func=Attribute(value=Attribute(value=Name(id='datetime', ctx=Load()), attr='datetime', ctx=Load()), attr='now', ctx=Load()), args=[], keywords=[]), attr='strftime', ctx=Load()), args=[Name(id='DATETIME_FORMAT', ctx=Load())], keywords=[]), Name(id='DATETIME_FORMAT', ctx=Load())], keywords=[])), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load()))])), Assign(targets=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[]), slice=Constant(value=0), ctx=Load())), Assign(targets=[Name(id='experiment_folder', ctx=Store())], value=Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='joinpath', ctx=Load()), args=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Load())], keywords=[])), Assign(targets=[Name(id='end_da', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='datetime', ctx=Load()), attr='datetime', ctx=Load()), attr='strptime', ctx=Load()), args=[Call(func=Attribute(value=Call(func=Attribute(value=Attribute(value=Name(id='datetime', ctx=Load()), attr='datetime', ctx=Load()), attr='now', ctx=Load()), args=[], keywords=[]), attr='strftime', ctx=Load()), args=[Name(id='DATETIME_FORMAT', ctx=Load())], keywords=[]), Name(id='DATETIME_FORMAT', ctx=Load())], keywords=[])), Assign(targets=[Name(id='folder_creation_datetime', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='datetime', ctx=Load()), attr='datetime', ctx=Load()), attr='strptime', ctx=Load()), args=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Load()), Name(id='DATETIME_FORMAT', ctx=Load())], keywords=[])), Assert(test=Compare(left=Name(id='end_da', ctx=Load()), ops=[GtE(), GtE()], comparators=[Name(id='folder_creation_datetime', ctx=Load()), Name(id='start_datetimeUb', ctx=Load())])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='experiment_folder', ctx=Load())], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=0)])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='start_experiment', ctx=Load()), args=[], keywords=[keyword(arg='job_type', value=Constant(value='test')), keyword(arg='group', value=Constant(value='1'))])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='experiment_folder', ctx=Load())], keywords=[])], keywords=[]), ops=[Eq()], comparators=[Constant(value=1)])), Assert(test=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='experiment_folder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='test')], keywords=[]), attr='joinpath', ctx=Load()), args=[Constant(value='1')], keywords=[]), attr='exists', ctx=Load()), args=[], keywords=[]))])], decorator_list=[]), FunctionDef(name='test_s3_file_logger_fail_save_tableuCJy', args=arguments(posonlyargs=[], args=[arg(arg='check_bucket_fn'), arg(arg='get_s3_client_fn')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="TϥƷest t͡hat Sǳ3Fi̎leǄ̖Logg̾9e\u0379r canō't ĲĖsav4̯Ƃ˯eΕ ta˩΅b̰leɽϼǚͮĨ \x98ͻbef̺ore ͩǄŧΙŪstarting *theˑǱ expƋerimenw§t.Ϝ̓ȣϓ")), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='S3FileLogger', ctx=Load()), args=[], keywords=[keyword(arg='bucket', value=Constant(value='example')), keyword(arg='experiments_folder', value=Constant(value='experiments_folder'))])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='first'), Constant(value='second'), Constant(value='third')], ctx=Load())])], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='ValueError', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='You should start experiment before'))]))], body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_table', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load()), Constant(value='example')], keywords=[]))])], decorator_list=[Call(func=Attribute(value=Name(id='mock', ctx=Load()), attr='patch', ctx=Load()), args=[Constant(value='etna.loggers.S3FileLogger._check_bucket')], keywords=[keyword(arg='return_value', value=Constant(value=None))]), Call(func=Attribute(value=Name(id='mock', ctx=Load()), attr='patch', ctx=Load()), args=[Constant(value='etna.loggers.S3FileLogger._get_s3_client')], keywords=[keyword(arg='return_value', value=Constant(value=None))])]), FunctionDef(name='test_s3_file_logger_save_table', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="Tɤestɹ tha-ʻt S3ȣFilƗϵʜeLogǛgeȎrſπ sȿaȥves̨ tableʙ cǄa΄fteºr st̡artinɤg ̱tɘhe ˰expχeriƴĞm¸ent.º\n\n    \nThŅi˃s\u0382 ʵCtest Ͼis œoptionaël and require˹ƗsǶ ̲envï̩ronmËent variable '̩ȕetnaȁ_tĐest_sȉʬ3_buckˈŢetM' to be˅ sϏġeǨtʪ.")), Assign(targets=[Name(id='bu', ctx=Store())], value=Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='getenv', ctx=Load()), args=[Constant(value='etna_test_s3_bucket')], keywords=[])), If(test=Compare(left=Name(id='bu', ctx=Load()), ops=[Is()], comparators=[Constant(value=None)]), body=[Raise(exc=Call(func=Name(id='oserror', ctx=Load()), args=[Constant(value="To perform this test you should set 'etna_test_s3_bucket' environment variable first")], keywords=[]))], orelse=[]), Assign(targets=[Name(id='experiments_folderRFjNZ', ctx=Store())], value=Constant(value='s3_logger_test')), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='S3FileLogger', ctx=Load()), args=[], keywords=[keyword(arg='bucket', value=Name(id='bu', ctx=Load())), keyword(arg='experiments_folder', value=Name(id='experiments_folderRFjNZ', ctx=Load())), keyword(arg='gzip', value=Constant(value=False))])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='start_experiment', ctx=Load()), args=[], keywords=[keyword(arg='job_type', value=Constant(value='test_simple')), keyword(arg='group', value=Constant(value='1'))])), Assign(targets=[Name(id='example_dffzohH', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='first'), Constant(value='second'), Constant(value='third')], ctx=Load())])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_table', ctx=Load()), args=[Name(id='example_dffzohH', ctx=Load()), Constant(value='example')], keywords=[])), Assign(targets=[Name(id='list_objects', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Attribute(value=Name(id='logger', ctx=Load()), attr='s3_client', ctx=Load()), attr='list_objects', ctx=Load()), args=[], keywords=[keyword(arg='Bucket', value=Name(id='bu', ctx=Load()))]), slice=Constant(value='Contents'), ctx=Load())), Assign(targets=[Name(id='test_files', ctx=Store())], value=ListComp(elt=Subscript(value=Name(id='filenamedjF', ctx=Load()), slice=Constant(value='Key'), ctx=Load()), generators=[comprehension(target=Name(id='filenamedjF', ctx=Store()), iter=Name(id='list_objects', ctx=Load()), ifs=[Call(func=Attribute(value=Subscript(value=Name(id='filenamedjF', ctx=Load()), slice=Constant(value='Key'), ctx=Load()), attr='startswith', ctx=Load()), args=[Name(id='experiments_folderRFjNZ', ctx=Load())], keywords=[])], is_async=0)])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='test_files', ctx=Load())], keywords=[]), ops=[Gt()], comparators=[Constant(value=0)])), Assign(targets=[Name(id='key', ctx=Store())], value=Call(func=Name(id='ma_x', ctx=Load()), args=[Name(id='test_files', ctx=Load())], keywords=[keyword(arg='key', value=Lambda(args=arguments(posonlyargs=[], args=[arg(arg='x')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=Call(func=Attribute(value=Attribute(value=Name(id='datetime', ctx=Load()), attr='datetime', ctx=Load()), attr='strptime', ctx=Load()), args=[Subscript(value=Call(func=Attribute(value=Name(id='x', ctx=Load()), attr='split', ctx=Load()), args=[Constant(value='/')], keywords=[]), slice=Constant(value=1), ctx=Load()), Name(id='DATETIME_FORMAT', ctx=Load())], keywords=[])))])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='NamedTemporaryFile', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='ouf', ctx=Store()))], body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='logger', ctx=Load()), attr='s3_client', ctx=Load()), attr='download_file', ctx=Load()), args=[], keywords=[keyword(arg='Bucket', value=Name(id='bu', ctx=Load())), keyword(arg='Key', value=Name(id='key', ctx=Load())), keyword(arg='Filename', value=Attribute(value=Name(id='ouf', ctx=Load()), attr='name', ctx=Load()))])), Assign(targets=[Name(id='read_example_df', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='read_csv', ctx=Load()), args=[Attribute(value=Name(id='ouf', ctx=Load()), attr='name', ctx=Load())], keywords=[]))]), Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='all', ctx=Load()), args=[Compare(left=Name(id='read_example_df', ctx=Load()), ops=[Eq()], comparators=[Name(id='example_dffzohH', ctx=Load())])], keywords=[]))], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='skip', ctx=Load())]), FunctionDef(name='test_base_file_logger_l_og_backtest_metrics', args=arguments(posonlyargs=[], args=[arg(arg='example_tsds', annotation=Name(id='TSDataset', ctx=Load())), arg(arg='aggregate_metrics', annotation=Name(id='_bool', ctx=Load()))], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='TemporaryDirectory', ctx=Load()), args=[], keywords=[]), optional_vars=Name(id='dirname', ctx=Store()))], body=[Assign(targets=[Name(id='c', ctx=Store())], value=Call(func=Attribute(value=Name(id='pathlib', ctx=Load()), attr='Path', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[])), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='LocalFileLogger', ctx=Load()), args=[], keywords=[keyword(arg='experiments_folder', value=Name(id='dirname', ctx=Load())), keyword(arg='gzip', value=Constant(value=False))])), Assign(targets=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Name(id='os', ctx=Load()), attr='listdir', ctx=Load()), args=[Name(id='dirname', ctx=Load())], keywords=[]), slice=Constant(value=0), ctx=Load())), Assign(targets=[Name(id='experiment_folder', ctx=Store())], value=Call(func=Attribute(value=Name(id='c', ctx=Load()), attr='joinpath', ctx=Load()), args=[Name(id='EXPERIMENT_FOLDER_NAME', ctx=Load())], keywords=[])), Assign(targets=[Name(id='i_dx', ctx=Store())], value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='add', ctx=Load()), args=[Name(id='logger', ctx=Load())], keywords=[])), Assign(targets=[Name(id='metricsF', ctx=Store())], value=List(elts=[Call(func=Name(id='MAE', ctx=Load()), args=[], keywords=[]), Call(func=Name(id='MSE', ctx=Load()), args=[], keywords=[]), Call(func=Name(id='SMAPE', ctx=Load()), args=[], keywords=[])], ctx=Load())), Assign(targets=[Name(id='pipeline', ctx=Store())], value=Call(func=Name(id='Pipeline', ctx=Load()), args=[], keywords=[keyword(arg='model', value=Call(func=Name(id='NaiveModel', ctx=Load()), args=[], keywords=[])), keyword(arg='horizon', value=Constant(value=10))])), Assign(targets=[Name(id='n_foldsqgAJh', ctx=Store())], value=Constant(value=5)), Assign(targets=[Tuple(elts=[Name(id='metrics_df', ctx=Store()), Name(id='fo', ctx=Store()), Name(id='fold_info_df', ctx=Store())], ctx=Store())], value=Call(func=Attribute(value=Name(id='pipeline', ctx=Load()), attr='backtest', ctx=Load()), args=[], keywords=[keyword(arg='ts', value=Name(id='example_tsds', ctx=Load())), keyword(arg='metrics', value=Name(id='metricsF', ctx=Load())), keyword(arg='n_jobs', value=Constant(value=1)), keyword(arg='n_folds', value=Name(id='n_foldsqgAJh', ctx=Load())), keyword(arg='aggregate_metrics', value=Name(id='aggregate_metrics', ctx=Load()))])), Assign(targets=[Name(id='crossval_results_fo', ctx=Store())], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='experiment_folder', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='crossval_results')], keywords=[]), attr='joinpath', ctx=Load()), args=[Constant(value='all')], keywords=[])), Assign(targets=[Name(id='metrics_df', ctx=Store())], value=Call(func=Attribute(value=Name(id='metrics_df', ctx=Load()), attr='reset_index', ctx=Load()), args=[], keywords=[keyword(arg='drop', value=Constant(value=True))])), Assign(targets=[Name(id='metric', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='read_csv', ctx=Load()), args=[Call(func=Attribute(value=Name(id='crossval_results_fo', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='metrics.csv')], keywords=[])], keywords=[])), Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='all', ctx=Load()), args=[Compare(left=Subscript(value=Name(id='metric', ctx=Load()), slice=Constant(value='segment'), ctx=Load()), ops=[Eq()], comparators=[Subscript(value=Name(id='metrics_df', ctx=Load()), slice=Constant(value='segment'), ctx=Load())])], keywords=[])), Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='allclose', ctx=Load()), args=[Call(func=Attribute(value=Name(id='metric', ctx=Load()), attr='drop', ctx=Load()), args=[], keywords=[keyword(arg='columns', value=List(elts=[Constant(value='segment')], ctx=Load()))]), Call(func=Attribute(value=Name(id='metrics_df', ctx=Load()), attr='drop', ctx=Load()), args=[], keywords=[keyword(arg='columns', value=List(elts=[Constant(value='segment')], ctx=Load()))])], keywords=[])), Assign(targets=[Name(id='fo', ctx=Store())], value=Call(func=Attribute(value=Name(id='TSDataset', ctx=Load()), attr='to_flatten', ctx=Load()), args=[Name(id='fo', ctx=Load())], keywords=[])), Assign(targets=[Name(id='forecast_df_saved', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='read_csv', ctx=Load()), args=[Call(func=Attribute(value=Name(id='crossval_results_fo', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='forecast.csv')], keywords=[])], keywords=[keyword(arg='parse_dates', value=List(elts=[Constant(value='timestamp')], ctx=Load())), keyword(arg='infer_datetime_format', value=Constant(value=True))])), Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='all', ctx=Load()), args=[Compare(left=Subscript(value=Name(id='forecast_df_saved', ctx=Load()), slice=List(elts=[Constant(value='timestamp'), Constant(value='fold_number'), Constant(value='segment')], ctx=Load()), ctx=Load()), ops=[Eq()], comparators=[Subscript(value=Name(id='fo', ctx=Load()), slice=List(elts=[Constant(value='timestamp'), Constant(value='fold_number'), Constant(value='segment')], ctx=Load()), ctx=Load())])], keywords=[])), Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='allclose', ctx=Load()), args=[Subscript(value=Name(id='forecast_df_saved', ctx=Load()), slice=Constant(value='target'), ctx=Load()), Subscript(value=Name(id='fo', ctx=Load()), slice=Constant(value='target'), ctx=Load())], keywords=[])), Assign(targets=[Name(id='fold_info_df', ctx=Store())], value=Call(func=Attribute(value=Name(id='fold_info_df', ctx=Load()), attr='reset_index', ctx=Load()), args=[], keywords=[keyword(arg='drop', value=Constant(value=True))])), Assign(targets=[Name(id='fold_info_df_saved', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='read_csv', ctx=Load()), args=[Call(func=Attribute(value=Name(id='crossval_results_fo', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='fold_info.csv')], keywords=[])], keywords=[keyword(arg='parse_dates', value=List(elts=[Constant(value='train_start_time'), Constant(value='train_end_time'), Constant(value='test_start_time'), Constant(value='test_end_time')], ctx=Load())), keyword(arg='infer_datetime_format', value=Constant(value=True))])), Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='all', ctx=Load()), args=[Compare(left=Name(id='fold_info_df_saved', ctx=Load()), ops=[Eq()], comparators=[Name(id='fold_info_df', ctx=Load())])], keywords=[])), With(items=[withitem(context_expr=Call(func=Name(id='open', ctx=Load()), args=[Call(func=Attribute(value=Name(id='crossval_results_fo', ctx=Load()), attr='joinpath', ctx=Load()), args=[Constant(value='metrics_summary.json')], keywords=[]), Constant(value='r')], keywords=[]), optional_vars=Name(id='inf', ctx=Store()))], body=[Assign(targets=[Name(id='metrics_summary', ctx=Store())], value=Call(func=Attribute(value=Name(id='json', ctx=Load()), attr='load', ctx=Load()), args=[Name(id='inf', ctx=Load())], keywords=[]))]), Assign(targets=[Name(id='statistic_keys', ctx=Store())], value=List(elts=[Constant(value='median'), Constant(value='mean'), Constant(value='std'), Constant(value='percentile_5'), Constant(value='percentile_25'), Constant(value='percentile_75'), Constant(value='percentile_95')], ctx=Load())), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Call(func=Attribute(value=Name(id='metrics_summary', ctx=Load()), attr='keys', ctx=Load()), args=[], keywords=[])], keywords=[]), ops=[Eq()], comparators=[BinOp(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='metricsF', ctx=Load())], keywords=[]), op=Mult(), right=Call(func=Name(id='len', ctx=Load()), args=[Name(id='statistic_keys', ctx=Load())], keywords=[]))]))]), Expr(value=Call(func=Attribute(value=Name(id='tslogger', ctx=Load()), attr='remove', ctx=Load()), args=[Name(id='i_dx', ctx=Load())], keywords=[]))], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='aggregate_metrics'), List(elts=[Constant(value=True), Constant(value=False)], ctx=Load())], keywords=[])]), FunctionDef(name='tes_t_s3_file_logger_save_dict', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="TTήe²͚ãsŤɩÕtŊĔ tåhačt Sɸõ3Fɲ˄°iǥlǦ΄eLi˩ogͯgeʔͺrǆ saveCs̅ dǿict afte̦r st3airti\x86˲˻̸ng the ex±³ŰɰpeȽɨ³rʝimeĩʌ+̨nΣˊtĒ.Ïh#BCNPJUEzWiqVRSXsbLog\n\nTϻhiϘɸs ?̿\x99ÎǛt7\x99esʦtˀ isʗ˾ ǂ0opȂtiϋϑ\x98ɣonϫ¾ˤaí˜ų̀ƈˉĸl žanďdŎ ȶȼrĒͦĿǱequπHireÐƄ˷s̬͝× e̅ϾnvʐüȨ\u0379ir£OoȭnÕͭmenɬt uϛvǻariaϮbleʓŰ 'et\x9fna_teɖº̸ʊsțˋ_s}3Ǎ_bu̺cĭĶϳkʂȃʉet'Ϊ ŖtƀȂoƘś Ĩbe sǁet.sȶ˄")), Assign(targets=[Name(id='bu', ctx=Store())], value=Subscript(value=Attribute(value=Name(id='os', ctx=Load()), attr='environ', ctx=Load()), slice=Constant(value='etna_test_s3_bucket'), ctx=Load())), Assign(targets=[Name(id='experiments_folderRFjNZ', ctx=Store())], value=Constant(value='s3_logger_test')), Assign(targets=[Name(id='logger', ctx=Store())], value=Call(func=Name(id='S3FileLogger', ctx=Load()), args=[], keywords=[keyword(arg='bucket', value=Name(id='bu', ctx=Load())), keyword(arg='experiments_folder', value=Name(id='experiments_folderRFjNZ', ctx=Load())), keyword(arg='gzip', value=Constant(value=False))])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='start_experiment', ctx=Load()), args=[], keywords=[keyword(arg='job_type', value=Constant(value='test_simple')), keyword(arg='group', value=Constant(value='1'))])), Assign(targets=[Name(id='EXAMPLE_DICT', ctx=Store())], value=Dict(keys=[Constant(value='keys'), Constant(value='values')], values=[List(elts=[Constant(value=1), Constant(value=2), Constant(value=3)], ctx=Load()), List(elts=[Constant(value='first'), Constant(value='second'), Constant(value='third')], ctx=Load())])), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load()), attr='_save_dict', ctx=Load()), args=[Name(id='EXAMPLE_DICT', ctx=Load()), Constant(value='example')], keywords=[])), Assign(targets=[Name(id='list_objects', ctx=Store())], value=Subscript(value=Call(func=Attribute(value=Attribute(value=Name(id='logger', ctx=Load()), attr='s3_client', ctx=Load()), attr='list_objects', ctx=Load()), args=[], keywords=[keyword(arg='Bucket', value=Name(id='bu', ctx=Load()))]), slice=Constant(value='Contents'), ctx=Load())), Assign(targets=[Name(id='test_files', ctx=Store())], value=ListComp(elt=Subscript(value=Name(id='filenamedjF', ctx=Load()), slice=Constant(value='Key'), ctx=Load()), generators=[comprehension(target=Name(id='filenamedjF', ctx=Store()), iter=Name(id='list_objects', ctx=Load()), ifs=[Call(func=Attribute(value=Subscript(value=Name(id='filenamedjF', ctx=Load()), slice=Constant(value='Key'), ctx=Load()), attr='startswith', ctx=Load()), args=[Name(id='experiments_folderRFjNZ', ctx=Load())], keywords=[])], is_async=0)])), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load()), args=[Name(id='test_files', ctx=Load())], keywords=[]), ops=[Gt()], comparators=[Constant(value=0)])), Assign(targets=[Name(id='key', ctx=Store())], value=Call(func=Name(id='ma_x', ctx=Load()), args=[Name(id='test_files', ctx=Load())], keywords=[keyword(arg='key', value=Lambda(args=arguments(posonlyargs=[], args=[arg(arg='x')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=Call(func=Attribute(value=Attribute(value=Name(id='datetime', ctx=Load()), attr='datetime', ctx=Load()), attr='strptime', ctx=Load()), args=[Subscript(value=Call(func=Attribute(value=Name(id='x', ctx=Load()), attr='split', ctx=Load()), args=[Constant(value='/')], keywords=[]), slice=Constant(value=1), ctx=Load()), Name(id='DATETIME_FORMAT', ctx=Load())], keywords=[])))])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='tempfile', ctx=Load()), attr='NamedTemporaryFile', ctx=Load()), args=[], keywords=[keyword(arg='delete', value=Constant(value=False))]), optional_vars=Name(id='ouf', ctx=Store()))], body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='logger', ctx=Load()), attr='s3_client', ctx=Load()), attr='download_file', ctx=Load()), args=[], keywords=[keyword(arg='Bucket', value=Name(id='bu', ctx=Load())), keyword(arg='Key', value=Name(id='key', ctx=Load())), keyword(arg='Filename', value=Attribute(value=Name(id='ouf', ctx=Load()), attr='name', ctx=Load()))])), Assign(targets=[Name(id='cur_path', ctx=Store())], value=Attribute(value=Name(id='ouf', ctx=Load()), attr='name', ctx=Load()))]), With(items=[withitem(context_expr=Call(func=Name(id='open', ctx=Load()), args=[Name(id='cur_path', ctx=Load()), Constant(value='r')], keywords=[]), optional_vars=Name(id='inf', ctx=Store()))], body=[Assign(targets=[Name(id='READ_EXAMPLE_DICT', ctx=Store())], value=Call(func=Attribute(value=Name(id='json', ctx=Load()), attr='load', ctx=Load()), args=[Name(id='inf', ctx=Load())], keywords=[]))]), Assert(test=Compare(left=Name(id='READ_EXAMPLE_DICT', ctx=Load()), ops=[Eq()], comparators=[Name(id='EXAMPLE_DICT', ctx=Load())]))], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='skip', ctx=Load())])], type_ignores=[])