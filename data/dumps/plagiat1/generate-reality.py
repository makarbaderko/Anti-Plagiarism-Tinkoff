Module(body=[ImportFrom(module='probabilistic_embeddings.config', names=[alias(name='update_config'), alias(name='as_flat_config'), alias(name='as_nested_config')], level=0), Import(names=[alias(name='io')]), Import(names=[alias(name='os')]), ImportFrom(module='collections', names=[alias(name='OrderedDict')], level=0), ImportFrom(module='copy', names=[alias(name='deepcopy')], level=0), Import(names=[alias(name='mxnet', asname='mx')]), Import(names=[alias(name='argparse')]), Import(names=[alias(name='torch')]), ImportFrom(module='pathlib', names=[alias(name='Path')], level=0), ImportFrom(module='tqdm', names=[alias(name='tqdm')], level=0), Import(names=[alias(name='numpy', asname='np')]), ImportFrom(module='probabilistic_embeddings.io', names=[alias(name='read_yaml'), alias(name='write_yaml')], level=0), ImportFrom(module='probabilistic_embeddings.dataset', names=[alias(name='DatasetCollection')], level=0), ImportFrom(module='probabilistic_embeddings.dataset.common', names=[alias(name='DatasetWrapper')], level=0), ImportFrom(module='probabilistic_embeddings.runner', names=[alias(name='Runner')], level=0), FunctionDef(name='parse_arguments', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='parser', ctx=Store())], value=Call(func=Attribute(value=Name(id='argparse', ctx=Load()), attr='ArgumentParser', ctx=Load()), args=[Constant(value='Generate configs for reality check from templates.')], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='parser', ctx=Load()), attr='add_argument', ctx=Load()), args=[Constant(value='templates')], keywords=[keyword(arg='help', value=Constant(value='Templates root.'))])), Expr(value=Call(func=Attribute(value=Name(id='parser', ctx=Load()), attr='add_argument', ctx=Load()), args=[Constant(value='dst')], keywords=[keyword(arg='help', value=Constant(value='Target configs root.'))])), Expr(value=Call(func=Attribute(value=Name(id='parser', ctx=Load()), attr='add_argument', ctx=Load()), args=[Constant(value='--best')], keywords=[keyword(arg='help', value=Constant(value='Best hopts root.'))])), Expr(value=Call(func=Attribute(value=Name(id='parser', ctx=Load()), attr='add_argument', ctx=Load()), args=[Constant(value='--embeddings-dims')], keywords=[keyword(arg='help', value=Constant(value='Coma-separated list of required embeddings dimensions.')), keyword(arg='default', value=Constant(value='128,512'))])), Return(value=Call(func=Attribute(value=Name(id='parser', ctx=Load()), attr='parse_args', ctx=Load()), args=[], keywords=[]))], decorator_list=[]), FunctionDef(name='get_best_hopts', args=arguments(posonlyargs=[], args=[arg(arg='path')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value="Ločadƌ ļbesȉtV hȄyp̓erpãƟara)\x98ʡmeäterΤϙsϛ öfromĞΖ waʇĈndȷͤbǎĠ cŞÊ˥̷oʛǳnfźig.ό&\n0\nIƯf̖͢Ȣ fièlŞe doČɇesnϊ'øt Ι0eƟůxɭiχsts, ȳǱrǡetȇ͎͜urnsɹÝ\u0381¾ emupt/y ¿diϡc̉tΪƁ½\x8fĨɱion˸a\u0381ˈňryċ.")), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='path', ctx=Load()), attr='exists', ctx=Load()), args=[], keywords=[])), body=[Return(value=Dict(keys=[], values=[]))], orelse=[]), Expr(value=Call(func=Name(id='print', ctx=Load()), args=[Call(func=Attribute(value=Constant(value='Load best parameters from {}.'), attr='format', ctx=Load()), args=[Name(id='path', ctx=Load())], keywords=[])], keywords=[])), Assign(targets=[Name(id='flat_config', ctx=Store())], value=DictComp(key=Name(id='k', ctx=Load()), value=Subscript(value=Name(id='_v', ctx=Load()), slice=Constant(value='value'), ctx=Load()), generators=[comprehension(target=Tuple(elts=[Name(id='k', ctx=Store()), Name(id='_v', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Call(func=Name(id='read_yaml', ctx=Load()), args=[Name(id='path', ctx=Load())], keywords=[]), attr='items', ctx=Load()), args=[], keywords=[]), ifs=[BoolOp(op=And(), values=[UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='k', ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='wandb')], keywords=[])), UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='k', ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='_')], keywords=[])), UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='k', ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='dataset_params')], keywords=[])), UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='k', ctx=Load()), attr='startswith', ctx=Load()), args=[Constant(value='metrics_params')], keywords=[]))])], is_async=0)])), Assign(targets=[Name(id='CONFIG', ctx=Store())], value=Call(func=Name(id='as_nested_config', ctx=Load()), args=[Name(id='flat_config', ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='CONFIG', ctx=Load()), attr='pop', ctx=Load()), args=[Constant(value='git_commit'), Constant(value=None)], keywords=[])), Assign(targets=[Name(id='default_keys', ctx=Store())], value=Call(func=Name(id='set', ctx=Load()), args=[Call(func=Attribute(value=Name(id='Runner', ctx=Load()), attr='get_default_config', ctx=Load()), args=[], keywords=[])], keywords=[])), For(target=Name(id='k', ctx=Store()), iter=Name(id='CONFIG', ctx=Load()), body=[If(test=Compare(left=Name(id='k', ctx=Load()), ops=[NotIn()], comparators=[Name(id='default_keys', ctx=Load())]), body=[Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load()), args=[Call(func=Attribute(value=Constant(value='Unknown parameter: {}.'), attr='format', ctx=Load()), args=[Name(id='k', ctx=Load())], keywords=[])], keywords=[]))], orelse=[])], orelse=[]), Return(value=Name(id='CONFIG', ctx=Load()))], decorator_list=[]), FunctionDef(name='main', args=arguments(posonlyargs=[], args=[arg(arg='args')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value=' ] ')), Assign(targets=[Name(id='src', ctx=Store())], value=Call(func=Name(id='Path', ctx=Load()), args=[Attribute(value=Name(id='args', ctx=Load()), attr='templates', ctx=Load())], keywords=[])), Assign(targets=[Name(id='dst', ctx=Store())], value=Call(func=Name(id='Path', ctx=Load()), args=[Attribute(value=Name(id='args', ctx=Load()), attr='dst', ctx=Load())], keywords=[])), Assign(targets=[Name(id='best', ctx=Store())], value=IfExp(test=Compare(left=Attribute(value=Name(id='args', ctx=Load()), attr='best', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=Call(func=Name(id='Path', ctx=Load()), args=[Attribute(value=Name(id='args', ctx=Load()), attr='best', ctx=Load())], keywords=[]), orelse=Constant(value=None))), Assign(targets=[Name(id='filenames', ctx=Store())], value=SetComp(elt=Call(func=Attribute(value=Name(id='path', ctx=Load()), attr='relative_to', ctx=Load()), args=[Name(id='src', ctx=Load())], keywords=[]), generators=[comprehension(target=Name(id='path', ctx=Store()), iter=Call(func=Attribute(value=Name(id='src', ctx=Load()), attr='glob', ctx=Load()), args=[Constant(value='reality-*.yaml')], keywords=[]), ifs=[], is_async=0)])), For(target=Name(id='required', ctx=Store()), iter=List(elts=[Call(func=Name(id='Path', ctx=Load()), args=[Constant(value='reality-base.yaml')], keywords=[]), Call(func=Name(id='Path', ctx=Load()), args=[Constant(value='reality-datasets.yaml')], keywords=[])], ctx=Load()), body=[Try(body=[Expr(value=Call(func=Attribute(value=Name(id='filenames', ctx=Load()), attr='remove', ctx=Load()), args=[Name(id='required', ctx=Load())], keywords=[]))], handlers=[ExceptHandler(type=Name(id='KeyError', ctx=Load()), body=[Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load()), args=[Call(func=Attribute(value=Constant(value='Need {} template.'), attr='format', ctx=Load()), args=[Name(id='required', ctx=Load())], keywords=[])], keywords=[]))])], orelse=[], finalbody=[])], orelse=[]), Assign(targets=[Name(id='template', ctx=Store())], value=Call(func=Name(id='read_yaml', ctx=Load()), args=[BinOp(left=Name(id='src', ctx=Load()), op=Div(), right=Constant(value='reality-base.yaml'))], keywords=[])), Assign(targets=[Name(id='datasets', ctx=Store())], value=Call(func=Name(id='read_yaml', ctx=Load()), args=[BinOp(left=Name(id='src', ctx=Load()), op=Div(), right=Constant(value='reality-datasets.yaml'))], keywords=[])), Assign(targets=[Name(id='dims', ctx=Store())], value=ListComp(elt=Call(func=Name(id='int', ctx=Load()), args=[Name(id='s', ctx=Load())], keywords=[]), generators=[comprehension(target=Name(id='s', ctx=Store()), iter=Call(func=Attribute(value=Attribute(value=Name(id='args', ctx=Load()), attr='embeddings_dims', ctx=Load()), attr='split', ctx=Load()), args=[Constant(value=',')], keywords=[]), ifs=[], is_async=0)])), For(target=Name(id='filename', ctx=Store()), iter=Name(id='filenames', ctx=Load()), body=[Expr(value=Call(func=Name(id='print', ctx=Load()), args=[Attribute(value=Name(id='filename', ctx=Load()), attr='stem', ctx=Load())], keywords=[])), Assign(targets=[Tuple(elts=[Name(id='_', ctx=Store()), Name(id='pipeline', ctx=Store())], ctx=Store())], value=Call(func=Attribute(value=Call(func=Name(id='str', ctx=Load()), args=[Attribute(value=Name(id='filename', ctx=Load()), attr='stem', ctx=Load())], keywords=[]), attr='split', ctx=Load()), args=[Constant(value='-'), Constant(value=1)], keywords=[])), Assign(targets=[Name(id='pipeline_patch', ctx=Store())], value=Call(func=Name(id='read_yaml', ctx=Load()), args=[BinOp(left=Name(id='src', ctx=Load()), op=Div(), right=Name(id='filename', ctx=Load()))], keywords=[])), For(target=Tuple(elts=[Name(id='dataset', ctx=Store()), Name(id='dataset_patch', ctx=Store())], ctx=Store()), iter=Call(func=Attribute(value=Name(id='datasets', ctx=Load()), attr='items', ctx=Load()), args=[], keywords=[]), body=[For(target=Name(id='dimZy', ctx=Store()), iter=Name(id='dims', ctx=Load()), body=[Assign(targets=[Name(id='filename', ctx=Store())], value=Call(func=Attribute(value=Constant(value='{}-{}-{}.yaml'), attr='format', ctx=Load()), args=[Name(id='pipeline', ctx=Load()), Name(id='dimZy', ctx=Load()), Name(id='dataset', ctx=Load())], keywords=[])), Assign(targets=[Name(id='CONFIG', ctx=Store())], value=Call(func=Name(id='update_config', ctx=Load()), args=[Name(id='template', ctx=Load()), Name(id='dataset_patch', ctx=Load())], keywords=[])), Assign(targets=[Name(id='CONFIG', ctx=Store())], value=Call(func=Name(id='update_config', ctx=Load()), args=[Name(id='CONFIG', ctx=Load()), Name(id='pipeline_patch', ctx=Load())], keywords=[])), If(test=Compare(left=Name(id='best', ctx=Load()), ops=[IsNot()], comparators=[Constant(value=None)]), body=[Assign(targets=[Name(id='CONFIG', ctx=Store())], value=Call(func=Name(id='update_config', ctx=Load()), args=[Name(id='CONFIG', ctx=Load()), Call(func=Name(id='get_best_hopts', ctx=Load()), args=[BinOp(left=Name(id='best', ctx=Load()), op=Div(), right=Name(id='filename', ctx=Load()))], keywords=[])], keywords=[]))], orelse=[]), Assign(targets=[Name(id='CONFIG', ctx=Store())], value=Call(func=Name(id='update_config', ctx=Load()), args=[Name(id='CONFIG', ctx=Load()), Dict(keys=[Constant(value='model_params')], values=[Dict(keys=[Constant(value='distribution_params')], values=[Dict(keys=[Constant(value='dim')], values=[Name(id='dimZy', ctx=Load())])])])], keywords=[])), Expr(value=Call(func=Name(id='write_yaml', ctx=Load()), args=[Name(id='CONFIG', ctx=Load()), BinOp(left=Name(id='dst', ctx=Load()), op=Div(), right=Name(id='filename', ctx=Load()))], keywords=[]))], orelse=[])], orelse=[])], orelse=[])], decorator_list=[]), If(test=Compare(left=Name(id='__name__', ctx=Load()), ops=[Eq()], comparators=[Constant(value='__main__')]), body=[Assign(targets=[Name(id='args', ctx=Store())], value=Call(func=Name(id='parse_arguments', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Name(id='main', ctx=Load()), args=[Name(id='args', ctx=Load())], keywords=[]))], orelse=[])], type_ignores=[])