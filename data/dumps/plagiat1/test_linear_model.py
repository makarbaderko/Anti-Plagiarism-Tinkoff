Module(body=[ImportFrom(module='etna.models.linear', names=[alias(name='LinearMultiSegmentModel')], level=0), Import(names=[alias(name='pandas', asname='pd')]), Import(names=[alias(name='pytest')]), ImportFrom(module='sklearn.linear_model', names=[alias(name='ElasticNet')], level=0), ImportFrom(module='sklearn.linear_model', names=[alias(name='LinearRegression')], level=0), ImportFrom(module='etna.datasets.tsdataset', names=[alias(name='TSDataset')], level=0), ImportFrom(module='etna.models.linear', names=[alias(name='ElasticMultiSegmentModel')], level=0), ImportFrom(module='etna.models.linear', names=[alias(name='ElasticPerSegmentModel')], level=0), Import(names=[alias(name='numpy', asname='np')]), ImportFrom(module='etna.models.linear', names=[alias(name='LinearPerSegmentModel')], level=0), ImportFrom(module='etna.pipeline', names=[alias(name='Pipeline')], level=0), ImportFrom(module='etna.transforms.math', names=[alias(name='LagTransform')], level=0), ImportFrom(module='etna.transforms.timestamp', names=[alias(name='DateFlagsTransform')], level=0), FunctionDef(name='t', args=arguments(posonlyargs=[], args=[arg(arg='random_seed')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='           }    Κ     ')), Assign(targets=[Name(id='periods', ctx=Store())], value=Constant(value=100)), Assign(targets=[Name(id='df1', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='timestamp')], values=[Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='date_range', ctx=Load()), args=[Constant(value='2020-01-01')], keywords=[keyword(arg='periods', value=Name(id='periods', ctx=Load()))])])], keywords=[])), Assign(targets=[Subscript(value=Name(id='df1', ctx=Load()), slice=Constant(value='segment'), ctx=Store())], value=Constant(value='segment_1')), Assign(targets=[Subscript(value=Name(id='df1', ctx=Load()), slice=Constant(value='target'), ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='np', ctx=Load()), attr='random', ctx=Load()), attr='uniform', ctx=Load()), args=[Constant(value=10), Constant(value=20)], keywords=[keyword(arg='size', value=Name(id='periods', ctx=Load()))])), Assign(targets=[Name(id='DF2', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='timestamp')], values=[Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='date_range', ctx=Load()), args=[Constant(value='2020-01-01')], keywords=[keyword(arg='periods', value=Name(id='periods', ctx=Load()))])])], keywords=[])), Assign(targets=[Subscript(value=Name(id='DF2', ctx=Load()), slice=Constant(value='segment'), ctx=Store())], value=Constant(value='segment_2')), Assign(targets=[Subscript(value=Name(id='DF2', ctx=Load()), slice=Constant(value='target'), ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='np', ctx=Load()), attr='random', ctx=Load()), attr='uniform', ctx=Load()), args=[UnaryOp(op=USub(), operand=Constant(value=15)), Constant(value=5)], keywords=[keyword(arg='size', value=Name(id='periods', ctx=Load()))])), Assign(targets=[Name(id='df_exog1', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='timestamp')], values=[Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='date_range', ctx=Load()), args=[Constant(value='2020-01-01')], keywords=[keyword(arg='periods', value=BinOp(left=Name(id='periods', ctx=Load()), op=Mult(), right=Constant(value=2)))])])], keywords=[])), Assign(targets=[Subscript(value=Name(id='df_exog1', ctx=Load()), slice=Constant(value='segment'), ctx=Store())], value=Constant(value='segment_1')), Assign(targets=[Subscript(value=Name(id='df_exog1', ctx=Load()), slice=Constant(value='cat_feature'), ctx=Store())], value=Constant(value='x')), Assign(targets=[Name(id='df_exog2', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[Dict(keys=[Constant(value='timestamp')], values=[Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='date_range', ctx=Load()), args=[Constant(value='2020-01-01')], keywords=[keyword(arg='periods', value=BinOp(left=Name(id='periods', ctx=Load()), op=Mult(), right=Constant(value=2)))])])], keywords=[])), Assign(targets=[Subscript(value=Name(id='df_exog2', ctx=Load()), slice=Constant(value='segment'), ctx=Store())], value=Constant(value='segment_2')), Assign(targets=[Subscript(value=Name(id='df_exog2', ctx=Load()), slice=Constant(value='cat_feature'), ctx=Store())], value=Constant(value='y')), Assign(targets=[Name(id='df', ctx=Store())], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='concat', ctx=Load()), args=[List(elts=[Name(id='df1', ctx=Load()), Name(id='DF2', ctx=Load())], ctx=Load())], keywords=[]), attr='reset_index', ctx=Load()), args=[], keywords=[keyword(arg='drop', value=Constant(value=True))])), Assign(targets=[Name(id='df_exog', ctx=Store())], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='concat', ctx=Load()), args=[List(elts=[Name(id='df_exog1', ctx=Load()), Name(id='df_exog2', ctx=Load())], ctx=Load())], keywords=[]), attr='reset_index', ctx=Load()), args=[], keywords=[keyword(arg='drop', value=Constant(value=True))])), Assign(targets=[Name(id='tsCv', ctx=Store())], value=Call(func=Name(id='TSDataset', ctx=Load()), args=[], keywords=[keyword(arg='df', value=Call(func=Attribute(value=Name(id='TSDataset', ctx=Load()), attr='to_dataset', ctx=Load()), args=[Name(id='df', ctx=Load())], keywords=[])), keyword(arg='freq', value=Constant(value='D')), keyword(arg='df_exog', value=Call(func=Attribute(value=Name(id='TSDataset', ctx=Load()), attr='to_dataset', ctx=Load()), args=[Name(id='df_exog', ctx=Load())], keywords=[])), keyword(arg='known_future', value=Constant(value='all'))])), Return(value=Name(id='tsCv', ctx=Load()))], decorator_list=[Attribute(value=Name(id='pytest', ctx=Load()), attr='fixture', ctx=Load())], returns=Name(id='TSDataset', ctx=Load())), FunctionDef(name='linear_segments_by_parameters', args=arguments(posonlyargs=[], args=[arg(arg='alpha_values'), arg(arg='intercept_values')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='dates', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='date_range', ctx=Load()), args=[], keywords=[keyword(arg='start', value=Constant(value='2020-02-01')), keyword(arg='freq', value=Constant(value='D')), keyword(arg='periods', value=Constant(value=210))])), Assign(targets=[Name(id='x', ctx=Store())], value=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='arange', ctx=Load()), args=[Constant(value=210)], keywords=[])), Assign(targets=[Tuple(elts=[Name(id='train', ctx=Store()), Name(id='test', ctx=Store())], ctx=Store())], value=Tuple(elts=[List(elts=[], ctx=Load()), List(elts=[], ctx=Load())], ctx=Load())), For(target=Name(id='i', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=3)], keywords=[]), body=[Expr(value=Call(func=Attribute(value=Name(id='train', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[], keywords=[])], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='test', ctx=Load()), attr='append', ctx=Load()), args=[Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='DataFrame', ctx=Load()), args=[], keywords=[])], keywords=[])), Assign(targets=[Tuple(elts=[Subscript(value=Subscript(value=Name(id='train', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load()), slice=Constant(value='timestamp'), ctx=Store()), Subscript(value=Subscript(value=Name(id='test', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load()), slice=Constant(value='timestamp'), ctx=Store())], ctx=Store())], value=Tuple(elts=[Subscript(value=Name(id='dates', ctx=Load()), slice=Slice(upper=UnaryOp(op=USub(), operand=Constant(value=7))), ctx=Load()), Subscript(value=Name(id='dates', ctx=Load()), slice=Slice(lower=UnaryOp(op=USub(), operand=Constant(value=7))), ctx=Load())], ctx=Load())), Assign(targets=[Tuple(elts=[Subscript(value=Subscript(value=Name(id='train', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load()), slice=Constant(value='segment'), ctx=Store()), Subscript(value=Subscript(value=Name(id='test', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load()), slice=Constant(value='segment'), ctx=Store())], ctx=Store())], value=Tuple(elts=[JoinedStr(values=[Constant(value='segment_'), FormattedValue(value=Name(id='i', ctx=Load()), conversion=-1)]), JoinedStr(values=[Constant(value='segment_'), FormattedValue(value=Name(id='i', ctx=Load()), conversion=-1)])], ctx=Load())), Assign(targets=[Name(id='alphalhC', ctx=Store())], value=Subscript(value=Name(id='alpha_values', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load())), Assign(targets=[Name(id='intercept', ctx=Store())], value=Subscript(value=Name(id='intercept_values', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load())), Assign(targets=[Name(id='target', ctx=Store())], value=BinOp(left=BinOp(left=Name(id='x', ctx=Load()), op=Mult(), right=Name(id='alphalhC', ctx=Load())), op=Add(), right=Name(id='intercept', ctx=Load()))), Assign(targets=[Tuple(elts=[Subscript(value=Subscript(value=Name(id='train', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load()), slice=Constant(value='target'), ctx=Store()), Subscript(value=Subscript(value=Name(id='test', ctx=Load()), slice=Name(id='i', ctx=Load()), ctx=Load()), slice=Constant(value='target'), ctx=Store())], ctx=Store())], value=Tuple(elts=[Subscript(value=Name(id='target', ctx=Load()), slice=Slice(upper=UnaryOp(op=USub(), operand=Constant(value=7))), ctx=Load()), Subscript(value=Name(id='target', ctx=Load()), slice=Slice(lower=UnaryOp(op=USub(), operand=Constant(value=7))), ctx=Load())], ctx=Load()))], orelse=[]), Assign(targets=[Name(id='train_df_all', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='concat', ctx=Load()), args=[Name(id='train', ctx=Load())], keywords=[keyword(arg='ignore_index', value=Constant(value=True))])), Assign(targets=[Name(id='test_df_all', ctx=Store())], value=Call(func=Attribute(value=Name(id='pd', ctx=Load()), attr='concat', ctx=Load()), args=[Name(id='test', ctx=Load())], keywords=[keyword(arg='ignore_index', value=Constant(value=True))])), Assign(targets=[Name(id='train_ts', ctx=Store())], value=Call(func=Name(id='TSDataset', ctx=Load()), args=[Call(func=Attribute(value=Name(id='TSDataset', ctx=Load()), attr='to_dataset', ctx=Load()), args=[Name(id='train_df_all', ctx=Load())], keywords=[]), Constant(value='D')], keywords=[])), Assign(targets=[Name(id='test_ts', ctx=Store())], value=Call(func=Name(id='TSDataset', ctx=Load()), args=[Call(func=Attribute(value=Name(id='TSDataset', ctx=Load()), attr='to_dataset', ctx=Load()), args=[Name(id='test_df_all', ctx=Load())], keywords=[]), Constant(value='D')], keywords=[])), Return(value=Tuple(elts=[Name(id='train_ts', ctx=Load()), Name(id='test_ts', ctx=Load())], ctx=Load()))], decorator_list=[]), FunctionDef(name='linear_segments_ts_unique', args=arguments(posonlyargs=[], args=[arg(arg='random_seed')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='alpha_values', ctx=Store())], value=ListComp(elt=BinOp(left=BinOp(left=Call(func=Attribute(value=Attribute(value=Name(id='np', ctx=Load()), attr='random', ctx=Load()), attr='rand', ctx=Load()), args=[], keywords=[]), op=Mult(), right=Constant(value=4)), op=Sub(), right=Constant(value=2)), generators=[comprehension(target=Name(id='_', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=3)], keywords=[]), ifs=[], is_async=0)])), Assign(targets=[Name(id='intercept_values', ctx=Store())], value=ListComp(elt=BinOp(left=BinOp(left=Call(func=Attribute(value=Attribute(value=Name(id='np', ctx=Load()), attr='random', ctx=Load()), attr='rand', ctx=Load()), args=[], keywords=[]), op=Mult(), right=Constant(value=4)), op=Add(), right=Constant(value=1)), generators=[comprehension(target=Name(id='_', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=3)], keywords=[]), ifs=[], is_async=0)])), Return(value=Call(func=Name(id='linear_segments_by_parameters', ctx=Load()), args=[Name(id='alpha_values', ctx=Load()), Name(id='intercept_values', ctx=Load())], keywords=[]))], decorator_list=[Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='fixture', ctx=Load()), args=[], keywords=[])]), FunctionDef(name='linear_se', args=arguments(posonlyargs=[], args=[arg(arg='random_seed')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='alpha_values', ctx=Store())], value=BinOp(left=List(elts=[BinOp(left=BinOp(left=Call(func=Attribute(value=Attribute(value=Name(id='np', ctx=Load()), attr='random', ctx=Load()), attr='rand', ctx=Load()), args=[], keywords=[]), op=Mult(), right=Constant(value=4)), op=Sub(), right=Constant(value=2))], ctx=Load()), op=Mult(), right=Constant(value=3))), Assign(targets=[Name(id='intercept_values', ctx=Store())], value=ListComp(elt=BinOp(left=BinOp(left=Call(func=Attribute(value=Attribute(value=Name(id='np', ctx=Load()), attr='random', ctx=Load()), attr='rand', ctx=Load()), args=[], keywords=[]), op=Mult(), right=Constant(value=4)), op=Add(), right=Constant(value=1)), generators=[comprehension(target=Name(id='_', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=3)], keywords=[]), ifs=[], is_async=0)])), Return(value=Call(func=Name(id='linear_segments_by_parameters', ctx=Load()), args=[Name(id='alpha_values', ctx=Load()), Name(id='intercept_values', ctx=Load())], keywords=[]))], decorator_list=[Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='fixture', ctx=Load()), args=[], keywords=[])]), FunctionDef(name='test_not_fitted', args=arguments(posonlyargs=[], args=[arg(arg='mo_del'), arg(arg='linear_segments_ts_unique')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Tuple(elts=[Name(id='train', ctx=Store()), Name(id='test', ctx=Store())], ctx=Store())], value=Name(id='linear_segments_ts_unique', ctx=Load())), Assign(targets=[Name(id='lags', ctx=Store())], value=Call(func=Name(id='LagTransform', ctx=Load()), args=[], keywords=[keyword(arg='in_column', value=Constant(value='target')), keyword(arg='lags', value=List(elts=[Constant(value=3), Constant(value=4), Constant(value=5)], ctx=Load()))])), Expr(value=Call(func=Attribute(value=Name(id='train', ctx=Load()), attr='fit_transform', ctx=Load()), args=[List(elts=[Name(id='lags', ctx=Load())], ctx=Load())], keywords=[])), Assign(targets=[Name(id='to_forecast', ctx=Store())], value=Call(func=Attribute(value=Name(id='train', ctx=Load()), attr='make_future', ctx=Load()), args=[Constant(value=3)], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='ValueError', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='model is not fitted!'))]))], body=[Expr(value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='forecast', ctx=Load()), args=[Name(id='to_forecast', ctx=Load())], keywords=[]))])], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='model'), Tuple(elts=[Call(func=Name(id='LinearPerSegmentModel', ctx=Load()), args=[], keywords=[]), Call(func=Name(id='ElasticPerSegmentModel', ctx=Load()), args=[], keywords=[])], ctx=Load())], keywords=[])]), FunctionDef(name='test_repr_linear', args=arguments(posonlyargs=[], args=[arg(arg='model_class'), arg(arg='model_cla_ss_repr')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='kwargs', ctx=Store())], value=Dict(keys=[Constant(value='copy_X'), Constant(value='positive')], values=[Constant(value=True), Constant(value=True)])), Assign(targets=[Name(id='kwargs_repr', ctx=Store())], value=Constant(value='copy_X = True, positive = True')), Assign(targets=[Name(id='mo_del', ctx=Store())], value=Call(func=Name(id='model_class', ctx=Load()), args=[], keywords=[keyword(arg='fit_intercept', value=Constant(value=True)), keyword(value=Name(id='kwargs', ctx=Load()))])), Assign(targets=[Name(id='m', ctx=Store())], value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='__repr__', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='true_repr', ctx=Store())], value=JoinedStr(values=[FormattedValue(value=Name(id='model_cla_ss_repr', ctx=Load()), conversion=-1), Constant(value='(fit_intercept = True, '), FormattedValue(value=Name(id='kwargs_repr', ctx=Load()), conversion=-1), Constant(value=', )')])), Assert(test=Compare(left=Name(id='m', ctx=Load()), ops=[Eq()], comparators=[Name(id='true_repr', ctx=Load())]))], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='model_class, model_class_repr'), Tuple(elts=[Tuple(elts=[Name(id='LinearPerSegmentModel', ctx=Load()), Constant(value='LinearPerSegmentModel')], ctx=Load()), Tuple(elts=[Name(id='LinearMultiSegmentModel', ctx=Load()), Constant(value='LinearMultiSegmentModel')], ctx=Load())], ctx=Load())], keywords=[])]), FunctionDef(name='test_repr_elastic', args=arguments(posonlyargs=[], args=[arg(arg='model_class'), arg(arg='model_cla_ss_repr')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Cheɭck __repΚ΅βr__Έ ʆ͋ȽmeϭƒΦtho˪\u0378d Ço˄f E͑la{ĊstPiȹ̿®cPeǾžrSeg»mentMΰodel̀ and ElastimcMȆultÔiƤ̢SƑegmentModel.')), Assign(targets=[Name(id='kwargs', ctx=Store())], value=Dict(keys=[Constant(value='copy_X'), Constant(value='positive')], values=[Constant(value=True), Constant(value=True)])), Assign(targets=[Name(id='kwargs_repr', ctx=Store())], value=Constant(value='copy_X = True, positive = True')), Assign(targets=[Name(id='mo_del', ctx=Store())], value=Call(func=Name(id='model_class', ctx=Load()), args=[], keywords=[keyword(arg='alpha', value=Constant(value=1.0)), keyword(arg='l1_ratio', value=Constant(value=0.5)), keyword(arg='fit_intercept', value=Constant(value=True)), keyword(value=Name(id='kwargs', ctx=Load()))])), Assign(targets=[Name(id='m', ctx=Store())], value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='__repr__', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='true_repr', ctx=Store())], value=JoinedStr(values=[FormattedValue(value=Name(id='model_cla_ss_repr', ctx=Load()), conversion=-1), Constant(value='(alpha = 1.0, l1_ratio = 0.5, fit_intercept = True, '), FormattedValue(value=Name(id='kwargs_repr', ctx=Load()), conversion=-1), Constant(value=', )')])), Assert(test=Compare(left=Name(id='m', ctx=Load()), ops=[Eq()], comparators=[Name(id='true_repr', ctx=Load())]))], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='model_class, model_class_repr'), Tuple(elts=[Tuple(elts=[Name(id='ElasticPerSegmentModel', ctx=Load()), Constant(value='ElasticPerSegmentModel')], ctx=Load()), Tuple(elts=[Name(id='ElasticMultiSegmentModel', ctx=Load()), Constant(value='ElasticMultiSegmentModel')], ctx=Load())], ctx=Load())], keywords=[])]), FunctionDef(name='test_model_per_segment', args=arguments(posonlyargs=[], args=[arg(arg='linear_segments_ts_unique'), arg(arg='num_lags'), arg(arg='mo_del')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='GiĪvʹùeAϜʂn: D"ƳaʬtaİseǪƉt /wˠiƃth\u0381 3 \x8alĭinϗŒear seg̉ˇ̈ȝēmMͬenf͜ͅots ϒϴaͥ(ndõ LǱȇ\x95ineaͫnorR̝ΪĩegƑre\x97s˽ΎsioŮn or ElastƬicNĊet ȺͰmodel ȳthat9 pΑrā×edvictsg Ưp\x92ǶƁerx7 È,seĂgͪmeˆn͵̅t\nȫûWhĨe¶έn:΄ C̣d͔Ďġȣͩέȵreaɉtinɦg Ƒ`Μof laĸg͙đ fe\xadat\x9aɻurḙϤɅvǎsÂ to Ίtaξrg§etʇ,ȿ a̩Ϧpplying it toͣ dảtaseĐt ωan\u0380dũȨϗ mɩa¦ɝʛ͔ɶk,\x8fi̅ϡnǳg\u03a2ò Ȫθʾf͌oreǝΏcľaēϕśt fȮoð¼ĺr ÁǷh?o®r"iÇ̍ƀzon pe\x7fräiodsl\nˍƂTƤheľ˳nΐ:ŗ Preɼ\x89dicŘtiońȩs ̵Ƨp̏Ëe9r sϘłe/gmͼent is clʲ\u0378ose .ƈtodŜ real valuxŹes̾')), Assign(targets=[Name(id='horizon', ctx=Store())], value=Constant(value=7)), Assign(targets=[Tuple(elts=[Name(id='train', ctx=Store()), Name(id='test', ctx=Store())], ctx=Store())], value=Name(id='linear_segments_ts_unique', ctx=Load())), Assign(targets=[Name(id='lags', ctx=Store())], value=Call(func=Name(id='LagTransform', ctx=Load()), args=[], keywords=[keyword(arg='in_column', value=Constant(value='target')), keyword(arg='lags', value=ListComp(elt=BinOp(left=Name(id='i', ctx=Load()), op=Add(), right=Name(id='horizon', ctx=Load())), generators=[comprehension(target=Name(id='i', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=1), BinOp(left=Name(id='num_lags', ctx=Load()), op=Add(), right=Constant(value=1))], keywords=[]), ifs=[], is_async=0)]))])), Expr(value=Call(func=Attribute(value=Name(id='train', ctx=Load()), attr='fit_transform', ctx=Load()), args=[List(elts=[Name(id='lags', ctx=Load())], ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='test', ctx=Load()), attr='fit_transform', ctx=Load()), args=[List(elts=[Name(id='lags', ctx=Load())], ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='fit', ctx=Load()), args=[Name(id='train', ctx=Load())], keywords=[])), Assign(targets=[Name(id='to_forecast', ctx=Store())], value=Call(func=Attribute(value=Name(id='train', ctx=Load()), attr='make_future', ctx=Load()), args=[Name(id='horizon', ctx=Load())], keywords=[])), Assign(targets=[Name(id='res', ctx=Store())], value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='forecast', ctx=Load()), args=[Name(id='to_forecast', ctx=Load())], keywords=[])), For(target=Name(id='segment', ctx=Store()), iter=Attribute(value=Name(id='res', ctx=Load()), attr='segments', ctx=Load()), body=[Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='allclose', ctx=Load()), args=[Subscript(value=Name(id='test', ctx=Load()), slice=Tuple(elts=[Slice(), Name(id='segment', ctx=Load()), Constant(value='target')], ctx=Load()), ctx=Load()), Subscript(value=Name(id='res', ctx=Load()), slice=Tuple(elts=[Slice(), Name(id='segment', ctx=Load()), Constant(value='target')], ctx=Load()), ctx=Load())], keywords=[keyword(arg='atol', value=Constant(value=1))]))], orelse=[])], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='model'), List(elts=[Call(func=Name(id='LinearPerSegmentModel', ctx=Load()), args=[], keywords=[]), Call(func=Name(id='ElasticPerSegmentModel', ctx=Load()), args=[], keywords=[])], ctx=Load())], keywords=[]), Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='num_lags'), List(elts=[Constant(value=3), Constant(value=5), Constant(value=10), Constant(value=20), Constant(value=30)], ctx=Load())], keywords=[])]), FunctionDef(name='test_model_multi_segment', args=arguments(posonlyargs=[], args=[arg(arg='linear_se'), arg(arg='num_lags'), arg(arg='mo_del')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='horizon', ctx=Store())], value=Constant(value=7)), Assign(targets=[Tuple(elts=[Name(id='train', ctx=Store()), Name(id='test', ctx=Store())], ctx=Store())], value=Name(id='linear_se', ctx=Load())), Assign(targets=[Name(id='lags', ctx=Store())], value=Call(func=Name(id='LagTransform', ctx=Load()), args=[], keywords=[keyword(arg='in_column', value=Constant(value='target')), keyword(arg='lags', value=ListComp(elt=BinOp(left=Name(id='i', ctx=Load()), op=Add(), right=Name(id='horizon', ctx=Load())), generators=[comprehension(target=Name(id='i', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=1), BinOp(left=Name(id='num_lags', ctx=Load()), op=Add(), right=Constant(value=1))], keywords=[]), ifs=[], is_async=0)]))])), Expr(value=Call(func=Attribute(value=Name(id='train', ctx=Load()), attr='fit_transform', ctx=Load()), args=[List(elts=[Name(id='lags', ctx=Load())], ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='test', ctx=Load()), attr='fit_transform', ctx=Load()), args=[List(elts=[Name(id='lags', ctx=Load())], ctx=Load())], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='fit', ctx=Load()), args=[Name(id='train', ctx=Load())], keywords=[])), Assign(targets=[Name(id='to_forecast', ctx=Store())], value=Call(func=Attribute(value=Name(id='train', ctx=Load()), attr='make_future', ctx=Load()), args=[Name(id='horizon', ctx=Load())], keywords=[])), Assign(targets=[Name(id='res', ctx=Store())], value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='forecast', ctx=Load()), args=[Name(id='to_forecast', ctx=Load())], keywords=[])), For(target=Name(id='segment', ctx=Store()), iter=Attribute(value=Name(id='res', ctx=Load()), attr='segments', ctx=Load()), body=[Assert(test=Call(func=Attribute(value=Name(id='np', ctx=Load()), attr='allclose', ctx=Load()), args=[Subscript(value=Name(id='test', ctx=Load()), slice=Tuple(elts=[Slice(), Name(id='segment', ctx=Load()), Constant(value='target')], ctx=Load()), ctx=Load()), Subscript(value=Name(id='res', ctx=Load()), slice=Tuple(elts=[Slice(), Name(id='segment', ctx=Load()), Constant(value='target')], ctx=Load()), ctx=Load())], keywords=[keyword(arg='atol', value=Constant(value=1))]))], orelse=[])], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='model'), List(elts=[Call(func=Name(id='LinearMultiSegmentModel', ctx=Load()), args=[], keywords=[]), Call(func=Name(id='ElasticMultiSegmentModel', ctx=Load()), args=[], keywords=[])], ctx=Load())], keywords=[]), Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='num_lags'), List(elts=[Constant(value=3), Constant(value=5), Constant(value=10), Constant(value=20), Constant(value=30)], ctx=Load())], keywords=[])]), FunctionDef(name='test_no_warning_on_categorical_features', args=arguments(posonlyargs=[], args=[arg(arg='example_tsds'), arg(arg='mo_del')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='horizon', ctx=Store())], value=Constant(value=7)), Assign(targets=[Name(id='num_lags', ctx=Store())], value=Constant(value=5)), Assign(targets=[Name(id='lags', ctx=Store())], value=Call(func=Name(id='LagTransform', ctx=Load()), args=[], keywords=[keyword(arg='in_column', value=Constant(value='target')), keyword(arg='lags', value=ListComp(elt=BinOp(left=Name(id='i', ctx=Load()), op=Add(), right=Name(id='horizon', ctx=Load())), generators=[comprehension(target=Name(id='i', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=1), BinOp(left=Name(id='num_lags', ctx=Load()), op=Add(), right=Constant(value=1))], keywords=[]), ifs=[], is_async=0)]))])), Assign(targets=[Name(id='dateflags', ctx=Store())], value=Call(func=Name(id='DateFlagsTransform', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='example_tsds', ctx=Load()), attr='fit_transform', ctx=Load()), args=[List(elts=[Name(id='lags', ctx=Load()), Name(id='dateflags', ctx=Load())], ctx=Load())], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='warns', ctx=Load()), args=[Constant(value=None)], keywords=[]), optional_vars=Name(id='record', ctx=Store()))], body=[Assign(targets=[Name(id='_', ctx=Store())], value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='fit', ctx=Load()), args=[Name(id='example_tsds', ctx=Load())], keywords=[]))]), Assert(test=Compare(left=Call(func=Name(id='l', ctx=Load()), args=[ListComp(elt=Name(id='warning', ctx=Load()), generators=[comprehension(target=Name(id='warning', ctx=Store()), iter=Name(id='record', ctx=Load()), ifs=[Call(func=Attribute(value=Call(func=Name(id='strs', ctx=Load()), args=[Attribute(value=Name(id='warning', ctx=Load()), attr='message', ctx=Load())], keywords=[]), attr='startswith', ctx=Load()), args=[Constant(value="Arrays of bytes/strings is being converted to decimal numbers if dtype='numeric'.")], keywords=[])], is_async=0)])], keywords=[]), ops=[Eq()], comparators=[Constant(value=0)])), Assign(targets=[Name(id='to_forecast', ctx=Store())], value=Call(func=Attribute(value=Name(id='example_tsds', ctx=Load()), attr='make_future', ctx=Load()), args=[Name(id='horizon', ctx=Load())], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='warns', ctx=Load()), args=[Constant(value=None)], keywords=[]), optional_vars=Name(id='record', ctx=Store()))], body=[Assign(targets=[Name(id='_', ctx=Store())], value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='forecast', ctx=Load()), args=[Name(id='to_forecast', ctx=Load())], keywords=[]))]), Assert(test=Compare(left=Call(func=Name(id='l', ctx=Load()), args=[ListComp(elt=Name(id='warning', ctx=Load()), generators=[comprehension(target=Name(id='warning', ctx=Store()), iter=Name(id='record', ctx=Load()), ifs=[Call(func=Attribute(value=Call(func=Name(id='strs', ctx=Load()), args=[Attribute(value=Name(id='warning', ctx=Load()), attr='message', ctx=Load())], keywords=[]), attr='startswith', ctx=Load()), args=[Constant(value="Arrays of bytes/strings is being converted to decimal numbers if dtype='numeric'.")], keywords=[])], is_async=0)])], keywords=[]), ops=[Eq()], comparators=[Constant(value=0)]))], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='model'), List(elts=[Call(func=Name(id='LinearPerSegmentModel', ctx=Load()), args=[], keywords=[])], ctx=Load())], keywords=[])]), FunctionDef(name='test_raise_error_on_unconvertable_features', args=arguments(posonlyargs=[], args=[arg(arg='t'), arg(arg='mo_del')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='horizon', ctx=Store())], value=Constant(value=7)), Assign(targets=[Name(id='num_lags', ctx=Store())], value=Constant(value=5)), Assign(targets=[Name(id='lags', ctx=Store())], value=Call(func=Name(id='LagTransform', ctx=Load()), args=[], keywords=[keyword(arg='in_column', value=Constant(value='target')), keyword(arg='lags', value=ListComp(elt=BinOp(left=Name(id='i', ctx=Load()), op=Add(), right=Name(id='horizon', ctx=Load())), generators=[comprehension(target=Name(id='i', ctx=Store()), iter=Call(func=Name(id='range', ctx=Load()), args=[Constant(value=1), BinOp(left=Name(id='num_lags', ctx=Load()), op=Add(), right=Constant(value=1))], keywords=[]), ifs=[], is_async=0)]))])), Assign(targets=[Name(id='dateflags', ctx=Store())], value=Call(func=Name(id='DateFlagsTransform', ctx=Load()), args=[], keywords=[])), Expr(value=Call(func=Attribute(value=Name(id='t', ctx=Load()), attr='fit_transform', ctx=Load()), args=[List(elts=[Name(id='lags', ctx=Load()), Name(id='dateflags', ctx=Load())], ctx=Load())], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='ValueError', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='Only convertible to numeric features are accepted!'))]))], body=[Assign(targets=[Name(id='_', ctx=Store())], value=Call(func=Attribute(value=Name(id='mo_del', ctx=Load()), attr='fit', ctx=Load()), args=[Name(id='t', ctx=Load())], keywords=[]))])], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='model'), List(elts=[Call(func=Name(id='LinearPerSegmentModel', ctx=Load()), args=[], keywords=[])], ctx=Load())], keywords=[])]), FunctionDef(name='test_get_model_multi', args=arguments(posonlyargs=[], args=[arg(arg='etna_class'), arg(arg='expected_model_class')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='etna_model', ctx=Store())], value=Call(func=Name(id='etna_class', ctx=Load()), args=[], keywords=[])), Assign(targets=[Name(id='mo_del', ctx=Store())], value=Call(func=Attribute(value=Name(id='etna_model', ctx=Load()), attr='get_model', ctx=Load()), args=[], keywords=[])), Assert(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='mo_del', ctx=Load()), Name(id='expected_model_class', ctx=Load())], keywords=[]))], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='etna_class,expected_model_class'), Tuple(elts=[Tuple(elts=[Name(id='ElasticMultiSegmentModel', ctx=Load()), Name(id='ElasticNet', ctx=Load())], ctx=Load()), Tuple(elts=[Name(id='LinearMultiSegmentModel', ctx=Load()), Name(id='LinearRegression', ctx=Load())], ctx=Load())], ctx=Load())], keywords=[])]), FunctionDef(name='test_get_model_per_segment_before_training', args=arguments(posonlyargs=[], args=[], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Assign(targets=[Name(id='etna_model', ctx=Store())], value=Call(func=Name(id='LinearPerSegmentModel', ctx=Load()), args=[], keywords=[])), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load()), attr='raises', ctx=Load()), args=[Name(id='ValueError', ctx=Load())], keywords=[keyword(arg='match', value=Constant(value='Can not get the dict with base models, the model is not fitted!'))]))], body=[Assign(targets=[Name(id='_', ctx=Store())], value=Call(func=Attribute(value=Name(id='etna_model', ctx=Load()), attr='get_model', ctx=Load()), args=[], keywords=[]))])], decorator_list=[]), FunctionDef(name='test_get_model_per_segment_after_training', args=arguments(posonlyargs=[], args=[arg(arg='example_tsds'), arg(arg='etna_class'), arg(arg='expected_model_class')], kwonlyargs=[], kw_defaults=[], defaults=[]), body=[Expr(value=Constant(value='Check that get_model method returns dict of objects of sklearn regressor class.')), Assign(targets=[Name(id='pip_eline', ctx=Store())], value=Call(func=Name(id='Pipeline', ctx=Load()), args=[], keywords=[keyword(arg='model', value=Call(func=Name(id='etna_class', ctx=Load()), args=[], keywords=[])), keyword(arg='transforms', value=List(elts=[Call(func=Name(id='LagTransform', ctx=Load()), args=[], keywords=[keyword(arg='in_column', value=Constant(value='target')), keyword(arg='lags', value=List(elts=[Constant(value=2), Constant(value=3)], ctx=Load()))])], ctx=Load()))])), Expr(value=Call(func=Attribute(value=Name(id='pip_eline', ctx=Load()), attr='fit', ctx=Load()), args=[], keywords=[keyword(arg='ts', value=Name(id='example_tsds', ctx=Load()))])), Assign(targets=[Name(id='models_dict', ctx=Store())], value=Call(func=Attribute(value=Attribute(value=Name(id='pip_eline', ctx=Load()), attr='model', ctx=Load()), attr='get_model', ctx=Load()), args=[], keywords=[])), Assert(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Name(id='models_dict', ctx=Load()), Name(id='_dict', ctx=Load())], keywords=[])), For(target=Name(id='segment', ctx=Store()), iter=Attribute(value=Name(id='example_tsds', ctx=Load()), attr='segments', ctx=Load()), body=[Assert(test=Call(func=Name(id='isinstance', ctx=Load()), args=[Subscript(value=Name(id='models_dict', ctx=Load()), slice=Name(id='segment', ctx=Load()), ctx=Load()), Name(id='expected_model_class', ctx=Load())], keywords=[]))], orelse=[])], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load()), attr='mark', ctx=Load()), attr='parametrize', ctx=Load()), args=[Constant(value='etna_class,expected_model_class'), Tuple(elts=[Tuple(elts=[Name(id='ElasticPerSegmentModel', ctx=Load()), Name(id='ElasticNet', ctx=Load())], ctx=Load()), Tuple(elts=[Name(id='LinearPerSegmentModel', ctx=Load()), Name(id='LinearRegression', ctx=Load())], ctx=Load())], ctx=Load())], keywords=[])])], type_ignores=[])